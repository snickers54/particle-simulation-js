function Particle(x,y){this.gravity=.0981,this.bounce_coeff=.8,this.data={},this.bounce={bottom:!0,ticks:0,"static":!1};var rho=10*Math.random(),angle=Math.random()*Math.PI*2;this.coordinates={x:x,y:y},this.vector={x:Math.cos(angle)*rho,y:Math.sin(angle)*rho}}function Settings(){}function HTML(arguments){var css="\n	.particle{display:block;z-index:50;position:absolute;width:10px;height:10px;border-radius:10px;background-color:black;}\n";this.addStyleTag(css),this.garbage_collector=[],this.colors=arguments.colors}function Canvas(arguments){this.colors=arguments.colors,this.canvas=this.generate_dom(),this.context=this.canvas.getContext("2d");var self=this;window.onresize=function(event){self.canvas.height=window.innerHeight,self.canvas.width=window.innerWidth,self.context=self.canvas.getContext("2d")}}function check_implementation(method,instance){return"function"!=typeof instance[method]?(console.error("Your class doesn't implement "+method+" method .."),!1):!0}function class_exists(myclass){return"undefined"==typeof window[myclass]?(console.error("The class "+myclass+" doesn't exists .."),!1):!0}function Renderer(arguments){return this.arguments=arguments,class_exists(arguments.type)===!1?!1:(this.type=arguments.type,this.instance={},this.instance[arguments.type]=new window[arguments.type](arguments),!0)}function Core(arguments){this.stopped=null,this.opts={particles_per_click:1,refresh_time:20,experimental:!0},this.controls={particles:[],initialized:!1,interval_id:null,paused:!1},this.settings=new Settings,this.renderer=new Renderer(arguments),this.settings.display_renderer_name(arguments.type),this.init()}Particle.prototype.update=function(){this.max_width=window.innerWidth,this.max_height=window.innerHeight,this.coordinates.x+=this.vector.x,this.coordinates.y+=this.vector.y,this.coordinates.x<0&&(this.vector.x*=-this.bounce_coeff,this.vector.y*=this.bounce_coeff,this.coordinates.x=0),this.coordinates.x>=this.max_width&&(this.vector.x*=-this.bounce_coeff,this.vector.y*=this.bounce_coeff,this.coordinates.x=this.max_width),this.coordinates.y<=0&&(this.vector.y*=-this.bounce_coeff,this.vector.x*=this.bounce_coeff,this.coordinates.y=0),this.bounce.bottom=!1,this.coordinates.y>this.max_height?(this.bounce.bottom=!0,this.bounce.ticks<20&&(this.bounce["static"]=!0),this.bounce.ticks=0,this.vector.y*=-this.bounce_coeff,this.vector.x*=this.bounce_coeff,this.coordinates.y=this.max_height):this.bounce.ticks+=1,this.vector.y+=this.gravity},Particle.prototype.get_vector=function(){return this.vector},Particle.prototype.get_coordinates=function(){return this.coordinates},Particle.prototype.is_static=function(){return this.bounce["static"]},Particle.prototype.__get=function(key){return this.data.hasOwnProperty(key)?this.data[key]:null},Particle.prototype.__set=function(key,value){this.data[key]=value},Settings.prototype.display_number_particles=function(length){var dom=document.getElementById("number_particles");dom.innerHTML=length+" particles"},Settings.prototype.pause=function(){var dom=document.getElementById("pause_resume");dom.innerHTML="Resume",dom.setAttribute("onclick","core.resume(event)")},Settings.prototype.resume=function(){var dom=document.getElementById("pause_resume");dom.innerHTML="Pause",dom.setAttribute("onclick","core.pause(event)")},Settings.prototype.display_renderer_name=function(type){var dom=document.getElementById("renderer_name");dom.innerHTML=type+" in use !"},HTML.prototype.generate_dom=function(particle){null===particle.__get("color")&&particle.__set("color",this.colors[Math.floor(Math.random()*this.colors.length)]);var new_div=document.createElement("div");return new_div.className="particle",document.body.appendChild(new_div),new_div.style["background-color"]=particle.__get("color"),new_div},HTML.prototype.addStyleTag=function(css){var d=document,tag=d.createElement("style");d.getElementsByTagName("head")[0].appendChild(tag),tag.setAttribute("type","text/css"),tag.styleSheet?tag.styleSheet.cssText=css:tag.appendChild(document.createTextNode(css))},HTML.prototype.clear=function(particles){if(particles.length<=this.garbage_collector.length/2)for(var i=0;i<this.garbage_collector.length/2-100;i++){var dom=this.garbage_collector.pop();dom.parentNode.removeChild(dom)}},HTML.prototype.reset=function(){for(var elem=document.getElementsByClassName("particle"),i=0;i<elem.length;i++)elem[i].style.display="none"},HTML.prototype.remove=function(particle){if(null!==particle.__get("dom")){var dom=particle.__get("dom");this.garbage_collector.push(dom),dom.style.display="none"}},HTML.prototype.get_css_value=function(key,dom){return window.getComputedStyle(dom).getPropertyValue(key)},HTML.prototype.draw=function(particle){var dom=particle.__get("dom");if(null===dom){var div;this.garbage_collector.length<=0?div=this.generate_dom(particle):(div=this.garbage_collector[0],this.garbage_collector.splice(0,1)),particle.__set("dom",div),dom=div}"none"===this.get_css_value("display",dom)&&(dom.style.display="block");var coordinates=particle.get_coordinates();dom.style.top=coordinates.y+"px",dom.style.left=coordinates.x+"px"},Canvas.prototype.reset=function(){this.clear()},Canvas.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},Canvas.prototype.draw=function(particle){null===particle.__get("color")&&particle.__set("color",this.colors[Math.floor(Math.random()*this.colors.length)]),this.context.beginPath();var coordinate=particle.get_coordinates();this.context.arc(coordinate.x,coordinate.y,5,0,2*Math.PI,!1),this.context.fillStyle=particle.__get("color"),this.context.fill()},Canvas.prototype.remove=function(particle){},Canvas.prototype.generate_dom=function(){var new_div=document.createElement("canvas");return new_div.className="canvas",new_div.height=window.innerHeight,new_div.width=window.innerWidth,document.body.appendChild(new_div),new_div},Renderer.prototype.reset=function(){return check_implementation("reset",this.instance[this.type])===!1?!1:void this.instance[this.type].reset()},Renderer.prototype.change=function(type){return class_exists(type)===!1?!1:(this.instance.hasOwnProperty(type)||(this.instance[type]=new window[type](this.arguments)),this.type=type,!0)},Renderer.prototype.clear=function(particles){return check_implementation("clear",this.instance[this.type])===!1?!1:void this.instance[this.type].clear(particles)},Renderer.prototype.draw=function(particles){if(check_implementation("draw",this.instance[this.type])===!1)return!1;for(var i=0;i<particles.length;i++){var particle=particles[i];this.instance[this.type].draw(particle)}return!0},Renderer.prototype.remove=function(particle){return check_implementation("remove",this.instance[this.type])===!1?!1:(this.instance[this.type].remove(particle),!0)},Core.prototype.init=function(){this.controls.initialized!==!0&&(this.controls.initialized=!0,this.opts.experimental===!0?this.controls.interval_id=window.requestAnimationFrame(this.tick.bind(this)):this.controls.interval_id=setInterval(this.tick.bind(this),this.opts.refresh_time))},Core.prototype.change_renderer=function(type){this.renderer.reset(),this.renderer.change(type)===!0&&this.settings.display_renderer_name(type)},Core.prototype.add=function(x,y){if(null!==this.controls.interval_id)for(var i=0;i<this.opts.particles_per_click;i++)this.controls.particles.push(new Particle(x,y))},Core.prototype.pause=function(event){this.opts.experimental===!0?(window.cancelAnimationFrame(this.controls.interval_id),this.controls.paused=!0):clearInterval(this.controls.interval_id),this.controls.interval_id=null,this.controls.initialized=!1,this.settings.pause()},Core.prototype.resume=function(event){this.controls.paused=!1,this.init(),this.settings.resume()},Core.prototype.get_controls=function(){return this.controls},Core.prototype.get_options=function(){return this.opts},Core.prototype.change_number_particles=function(value){isNaN(value)||(this.opts.particles_per_click=parseInt(value))},Core.prototype.tick=function(timestamp){this.renderer.clear(this.controls.particles);for(var i=this.controls.particles.length;i>0;i--){var particle=this.controls.particles[i-1];particle.is_static()?(this.renderer.remove(particle),this.controls.particles.splice(i-1,1)):particle.update()}this.settings.display_number_particles(this.controls.particles.length),this.renderer.draw(this.controls.particles),this.opts.experimental===!0&&this.controls.paused===!1&&(this.opts.interval_id=window.requestAnimationFrame(this.tick.bind(this)))};var core;window.onload=function(){core=new Core({type:"Canvas",colors:["black","blue","orange","brown","red","green","grey","whitesmoke","pink","darkblue","purple"]}),document.onclick=function(event){void 0===event&&(event=window.event);var target="target"in event?event.target:event.srcElement;"pause_resume"!==target.getAttribute("id")&&"nb_particles"!==target.getAttribute("name")&&"button"!==target.tagName.toLowerCase()&&core.add(event.pageX,event.pageY)}};
